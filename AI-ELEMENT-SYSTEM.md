# AI Element System Documentation

The AI Element system provides a powerful way to dynamically generate and render React components using AI models. This system consists of three main parts: the factory function, the AI Element component, and the slot wrapper.

## Overview

The AI Element system allows you to:
- Generate React components dynamically using AI prompts
- Pass props to AI-generated components
- Render components safely within a controlled environment
- Use different AI models (currently supports Gemini)
- Handle errors gracefully with custom error components

## Architecture

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   AI Model      │───▶│  createAIElement │───▶│ Bound Component │
│ (e.g. Gemini)   │    │  Factory Function│    │                 │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                                                         │
                                                         ▼
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│ AIElementSlot   │───▶│    AIElement     │───▶│ DynamicRenderer │
│   (Wrapper)     │    │   Component      │    │                 │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

## Core Components

### 1. Factory Function: `createAIElement`

Creates a React component bound to a specific AI model instance.

```typescript
import { createAIElement } from '../core/ai-element/create-ai-element';
import { GeminiModel } from '../core/ai';

const geminiModel = new GeminiModel("gemini-2.0-flash", "your-api-key");
const AIComponentGenerator = createAIElement(geminiModel);
```

### 2. Slot Wrapper: `AIElementSlot`

Provides context and optional styling for AI elements.

```tsx
import AIElementSlot from '../components/ai-element-slot';

<AIElementSlot width="400px" height="200px">
  <AIComponentGenerator prompt="..." />
</AIElementSlot>
```

### 3. AI Element: `AIElement`

The core component that handles AI generation and rendering (used internally).

## Usage Examples

### Basic Usage

```tsx
import React from 'react';
import { GeminiModel } from '../core/ai';
import { createAIElement } from '../core/ai-element/create-ai-element';
import AIElementSlot from '../components/ai-element-slot';

const App = () => {
  // Create model instance
  const geminiModel = new GeminiModel("gemini-2.0-flash", "your-api-key");
  
  // Create AI element component
  const AIComponentGenerator = createAIElement(geminiModel);

  return (
    <AIElementSlot width="300px" height="150px">
      <AIComponentGenerator
        prompt="Create a button that says 'Hello World' with blue background"
      />
    </AIElementSlot>
  );
};
```

### Passing Props to Generated Components

```tsx
<AIElementSlot width="400px" height="200px">
  <AIComponentGenerator
    prompt="Create a user profile card with name, email, and avatar"
    aiElementProps={{
      name: "John Doe",
      email: "john@example.com",
      avatar: "https://example.com/avatar.jpg"
    }}
  />
</AIElementSlot>
```

### Interactive Components with Event Handlers

```tsx
<AIElementSlot width="250px" height="100px">
  <AIComponentGenerator
    prompt="Create a button that calls onClick when clicked"
    aiElementProps={{
      onClick: () => alert("Button clicked!")
    }}
  />
</AIElementSlot>
```

### Counter Component with State

```tsx
<AIElementSlot width="200px" height="120px">
  <AIComponentGenerator
    prompt="Create a counter with increment/decrement buttons using useState"
    aiElementProps={{
      initialValue: 0
    }}
  />
</AIElementSlot>
```

### Complex Data Visualization

```tsx
<AIElementSlot width="500px" height="300px">
  <AIComponentGenerator
    prompt="Create a bar chart component that displays data with labels"
    aiElementProps={{
      data: [
        { label: "Q1", value: 100 },
        { label: "Q2", value: 150 },
        { label: "Q3", value: 120 },
        { label: "Q4", value: 180 }
      ],
      title: "Quarterly Sales",
      color: "#4CAF50"
    }}
  />
</AIElementSlot>
```

## Error Handling

### Custom Error Components

```tsx
const CustomErrorComponent = () => (
  <div style={{ 
    padding: "20px", 
    backgroundColor: "#ffebee", 
    border: "1px solid #f44336",
    borderRadius: "4px" 
  }}>
    <h4>⚠️ Generation Failed</h4>
    <p>Unable to generate component. Please try again.</p>
  </div>
);

<AIElementSlot width="300px" height="100px">
  <AIComponentGenerator
    prompt="Create a component"
    ErrorComponent={CustomErrorComponent}
  />
</AIElementSlot>
```

### Error Types

The system handles several types of errors:

1. **API Errors**: Invalid API keys, network issues, model unavailable
2. **Code Generation Errors**: Invalid React code generated by AI
3. **Compilation Errors**: Babel transformation failures
4. **Runtime Errors**: Errors during component execution

## Props Interface

### AIElementProps (used by bound component)

```typescript
interface AIElementProps {
  prompt: string;                        // AI prompt for component generation
  aiElementProps?: Record<string, any>;  // Props to pass to generated component
  ErrorComponent?: React.FC;             // Custom error component
}
```

### AIElementSlotProps

```typescript
interface AIElementSlotProps {
  height?: string | number;    // Container height (CSS units or pixels)
  width?: string | number;     // Container width (CSS units or pixels)
  children: React.ReactNode;   // AI Element component(s)
}
```

## Best Practices

### 1. Prompt Engineering

**Good Prompts:**
```typescript
// Specific and clear
"Create a button component with blue background and white text that calls onClick when clicked"

// Include styling requirements
"Create a user card with border, padding, and centered content showing name and email"

// Specify React features to use
"Create a counter component using useState hook with increment and decrement buttons"
```

**Avoid:**
```typescript
// Too vague
"Make a component"

// Missing context
"Create a button"
```

### 2. Props Design

Structure your props to match common React patterns:

```typescript
// Good - follows React conventions
aiElementProps={{
  title: "My Component",
  data: items,
  onClick: handleClick,
  className: "custom-style"
}}

// Avoid - unclear or complex structures
aiElementProps={{
  config: {
    settings: {
      ui: {
        title: "My Component"
      }
    }
  }
}}
```

### 3. Model Management

```typescript
// Create model instances once and reuse
const geminiModel = new GeminiModel("gemini-2.0-flash", apiKey);
const AIComponentGenerator = createAIElement(geminiModel);

// Don't create new instances for each component
// const AIComponentGenerator = createAIElement(new GeminiModel(...)); // ❌
```

### 4. Error Handling

Always provide meaningful error components:

```tsx
const ErrorComponent = ({ error }) => (
  <div className="error-container">
    <h4>Generation Failed</h4>
    <p>Please check your prompt and try again.</p>
    {process.env.NODE_ENV === 'development' && (
      <details>
        <summary>Error Details</summary>
        <pre>{error?.message}</pre>
      </details>
    )}
  </div>
);
```

## Advanced Usage

### Multiple Models

```typescript
const geminiModel = new GeminiModel("gemini-2.0-flash", geminiKey);
const GPTModel = new OpenAIModel("gpt-4", openaiKey); // hypothetical

const GeminiAI = createAIElement(geminiModel);
const GPTAI = createAIElement(GPTModel);

// Use different models for different purposes
<GeminiAI prompt="Create a creative component" />
<GPTAI prompt="Create a technical component" />
```

### Dynamic Prompt Generation

```typescript
const generatePrompt = (componentType: string, props: any) => {
  return `Create a ${componentType} component with these requirements: ${JSON.stringify(props)}`;
};

<AIComponentGenerator
  prompt={generatePrompt("dashboard", { charts: true, responsive: true })}
  aiElementProps={dashboardData}
/>
```

### Conditional Rendering

```typescript
const [showAI, setShowAI] = useState(false);
const [prompt, setPrompt] = useState("");

return (
  <div>
    <input 
      value={prompt} 
      onChange={(e) => setPrompt(e.target.value)}
      placeholder="Enter component description"
    />
    <button onClick={() => setShowAI(true)}>Generate</button>
    
    {showAI && prompt && (
      <AIElementSlot>
        <AIComponentGenerator prompt={prompt} />
      </AIElementSlot>
    )}
  </div>
);
```

## Performance Considerations

1. **Memoization**: The AI Element uses `useMemo` to cache generated components
2. **API Calls**: Each prompt change triggers a new API call
3. **Compilation**: Babel transformation happens for each generated code string
4. **Re-rendering**: Consider wrapping in `React.memo` if using dynamic props

## Security Considerations

1. **Code Execution**: Generated code is executed in a controlled environment
2. **API Keys**: Never expose API keys in client-side code
3. **Input Validation**: AI-generated code goes through Babel transformation
4. **Error Boundaries**: Use error boundaries to catch runtime errors

## Troubleshooting

### Common Issues

1. **"AIElement must be used inside an AIElementSlot"**
   - Ensure your AI element is wrapped in `<AIElementSlot>`

2. **API Key errors**
   - Check your API key is valid and has proper permissions
   - Ensure the key is properly set in environment variables

3. **Code compilation errors**
   - The AI might generate invalid React code
   - Use custom error components to handle these gracefully

4. **Props not reaching component**
   - Ensure you're using `aiElementProps` to pass props
   - Check that your prompt mentions the props you're passing

### Debug Mode

```typescript
// Enable detailed logging in development
const AIComponentGenerator = createAIElement(geminiModel);

// Check generated code in browser console
useEffect(() => {
  if (process.env.NODE_ENV === 'development') {
    console.log('Generated code:', generatedCode);
  }
}, [generatedCode]);
```

## Migration Guide

If upgrading from a previous version:

1. Replace direct `AIElement` usage with factory pattern:
   ```typescript
   // Old
   <AIElement model={geminiModel} prompt="..." />
   
   // New
   const AIComponentGenerator = createAIElement(geminiModel);
   <AIComponentGenerator prompt="..." />
   ```

2. Update prop passing:
   ```typescript
   // Old
   <AIElement {...props} />
   
   // New
   <AIComponentGenerator aiElementProps={props} />
   ```

## API Reference

See the TypeScript interfaces in the source code for complete API documentation:

- `src/core/ai-element/create-ai-element.ts`
- `src/components/ai-element.tsx`
- `src/components/ai-element-slot.tsx`
- `src/components/dynamic-renderer.tsx`
